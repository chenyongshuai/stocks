<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <link rel="stylesheet" href="../css/layui.css?v=1213121"/>
    <link rel="stylesheet" href="../css/global.css?v=122131"/>
</head>
<body>
	<div class="layui-main" style="margin-left: 15px;">
		<div class="layui-fluid">
			<fieldset class="layui-elem-field layui-field-title">
				<legend>自定义板块</legend>
			</fieldset>
			<div class="layui-card">
				<div class="layui-card-header layuiadmin-card-header-auto">
					<button class="layui-btn layuiadmin-btn-tags" data-type="add">添加</button>
					<button class="layui-btn layuiadmin-btn-tags" data-type="edit">修改</button>
					<button class="layui-btn layuiadmin-btn-tags" data-type="del">删除</button>
				</div>
				<div class="layui-card-body">
					<table id="category" lay-filter="tabledemo"></table>
				</div>
			</div>
		</div>
	</div>
	<script src="../js/jquery.min1.3.5.js"></script>
	<script src="../js/layui.js"></script>
	<script type="text/javascript">
			$(function(){
				layui.use('element', function(){
					var element = layui.element;
				});	
				layui.use(['table','layer'], function(){
					  var table = layui.table;
					  //方法级渲染
					  table.render({
					    elem: '#category'
					    ,url: '/plate/getPlateList'
					    ,cellMinWidth: 80
					    ,cols: [[
					      {field:'buid',type:'checkbox',
					    	  templet:function(d){
					      	  },
					      }
					      ,{field:'plateName', title: '板块名称'}
					      ,{field:'plateDesc', title: '板块描述'}
					      ,{field:'plateNo', title: '板块编码'}
					      ,{field:'createDate', title: '创建时间',sort: true}
					    ]]
					    ,id: 'category'
					    ,page: true
					    ,height: 315
					  });
					  
					  active = {
							  del: function(){
								  var checkStatus = table.checkStatus('category');
								  if(checkStatus.data.length==0){
									  layer.msg("请先选择要删除的内容");
								  }else{
									  var buidList = new Array();
									  $.each(checkStatus.data,function(index,value){
								    		buidList.push(value.buid);
								    	});
									  layer.open({
							    		    title: '删除板块',
							    	        type: 1
							    	        ,offset: 'auto' //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
							    	        ,id: 'layerDemo'+'auto' //防止重复弹出
							    	        ,content: '<div class="layui-form" lay-filter="layuiadmin-form-tags" id="layuiadmin-app-form-tags" style="padding-top: 30px; text-align: center;"><div class="layui-form-item">是否确认删除？</div></div>'
							    	        ,btn: ['确认','取消']
								    	 	 ,yes: function(index, layero){
								    		    //按钮【按钮一】的回调
								    		    $.ajax({
								    		    	url:'/plate/delPlate',
								    		    	data:{
								    		    		"buidList":buidList
										    		},
								    		    	async:false,
								    		    	traditional: true,
								    				success:function(data){
								    					if(data){
									    					table.reload('category');
									    					layer.msg("删除成功");
								    					}else{
									    					layer.msg("删除失败");
								    					}
								    				}
								    		    });
								    		    layer.closeAll();
								    		  }
								    		  ,btn2: function(index, layero){
								    		    //按钮【按钮二】的回调
								    		    layer.closeAll();
								    		    //return false 开启该代码可禁止点击该按钮关闭
								    		  }
							    	        ,btnAlign: 'c' //按钮居中
							    	        ,shade: 0.8 //不显示遮罩
							    	        ,success:function(layero, index){
							    	        }
							    	      });  
								  }
						      }
							  ,edit: function(){
								  var checkStatus = table.checkStatus('category');
								  if(checkStatus.data.length==0){
									  layer.msg("请先选择要修改的内容");
								  }else if(checkStatus.data.length>1){
									  layer.msg("请选择一行进行修改");
								  }else{
									  console.log(checkStatus.data);
									  var plate_buid = checkStatus.data[0].buid;
									  var plate_name = checkStatus.data[0].plateName;
									  var plate_desc = checkStatus.data[0].plateDesc;
									  var plate_no = checkStatus.data[0].plateNo;
									  layer.open({
							    		    title: '修改板块',
							    	        type: 1
							    	        ,offset: 'auto' //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
							    	        ,id: 'layerDemo'+'auto' //防止重复弹出
							    	        ,content: '<div class="layui-form" lay-filter="layuiadmin-form-tags" id="layuiadmin-app-form-tags" style="padding-top: 30px; text-align: center;"><div class="layui-form-item"><label class="layui-form-label">分类名</label><div class="layui-input-inline"><input id="plateName" type="text" name="tags" lay-verify="required" placeholder="请输入..." autocomplete="off" class="layui-input"></div></div><div class="layui-form-item"><label class="layui-form-label">分类描述</label><div class="layui-input-inline"><input id="plateDesc" type="text" name="tags" lay-verify="required" placeholder="请输入..." autocomplete="off" class="layui-input"></div></div><div class="layui-form-item"><label class="layui-form-label">编号</label><div class="layui-input-inline"><input id="plateNo" type="text" name="tags" lay-verify="required" placeholder="请输入..." autocomplete="off" class="layui-input"></div></div></div>'
							    	        ,btn: ['确认','取消']
								    	 	 ,yes: function(index, layero){
								    		    //按钮【按钮一】的回调
								    		    var plateName =  $("#plateName").val();
								    		    var plateDesc = $("#plateDesc").val();
								    		    var plateNo = $("#plateNo").val();
								    		    $.ajax({
								    		    	url:'/plate/editPlate',
								    		    	method:'post',
								    		    	data:{
								    		    		"buid":plate_buid,
										    			"plateName":plateName,
										    			"plateDesc":plateDesc,
										    			"plateNo":plateNo
										    		},
								    		    	async:false,
								    				success:function(data){
								    					if(data){
									    					table.reload('category');
									    					layer.msg("修改成功");
								    					}else{
									    					layer.msg("修改失败");
								    					}
								    				}
								    		    });
								    		    layer.closeAll();
								    		  }
								    		  ,btn2: function(index, layero){
								    		    //按钮【按钮二】的回调
								    		    layer.closeAll();
								    		    //return false 开启该代码可禁止点击该按钮关闭
								    		  }
							    	        ,btnAlign: 'c' //按钮居中
							    	        ,shade: 0.8 //不显示遮罩
							    	        ,success:function(layero, index){
							    	        	$("#plateName").val(plate_name);
								    		    $("#plateDesc").val(plate_desc);
								    		    $("#plateNo").val(plate_no);
							    	        }
							    	      });  
								  }
						      },
						      add: function(){
						    	  layer.open({
						    	        type: 1,
						    	        title: '添加板块'
						    	        ,offset: 'auto' //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
						    	        ,id: 'layerDemo'+'auto' //防止重复弹出
						    	        ,content: '<div class="layui-form" lay-filter="layuiadmin-form-tags" id="layuiadmin-app-form-tags" style="padding-top: 30px; text-align: center;"><div class="layui-form-item"><label class="layui-form-label">分类名</label><div class="layui-input-inline"><input id="plateName" type="text" name="tags" lay-verify="required" placeholder="请输入..." autocomplete="off" class="layui-input"></div></div><div class="layui-form-item"><label class="layui-form-label">分类描述</label><div class="layui-input-inline"><input id="plateDesc" type="text" name="tags" lay-verify="required" placeholder="请输入..." autocomplete="off" class="layui-input"></div></div><div class="layui-form-item"><label class="layui-form-label">编号</label><div class="layui-input-inline"><input id="plateNo" type="text" name="tags" lay-verify="required" placeholder="请输入..." autocomplete="off" class="layui-input"></div></div></div>'
						    	        ,btn: ['确认','取消']
							    	 	 ,yes: function(index, layero){
							    		    //按钮【按钮一】的回调
							    		    var plateName =  $("#plateName").val();
							    		    var plateDesc = $("#plateDesc").val();
							    		    var plateNo = $("#plateNo").val();
							    		    $.ajax({
							    		    	url:'/plate/addPlate',
							    		    	method:'post',
							    		    	data:{
									    			"plateName":plateName,
									    			"plateDesc":plateDesc,
									    			"plateNo":plateNo
									    		},
							    		    	async:false,
							    				success:function(data){
							    					if(data){
								    					table.reload('category');
								    					layer.msg("添加成功");
							    					}else{
								    					layer.msg("添加失败");
							    					}
							    				}
							    		    });
							    		    layer.closeAll();
							    		  }
							    		  ,btn2: function(index, layero){
							    		    //按钮【按钮二】的回调
							    		    layer.closeAll();
							    		    //return false 开启该代码可禁止点击该按钮关闭
							    		  }
						    	        ,btnAlign: 'c' //按钮居中
						    	        ,shade: 0.8 //不显示遮罩
						    	      });  
						      }
						    }  

					  $('.layui-btn.layuiadmin-btn-tags').on('click', function(){
					      var type = $(this).data('type');
					      active[type] ? active[type].call(this) : '';
					    });

				}); 
			});
	</script>
</body>
</html>